device_lib.list_local_devices(): [name: "/device:CPU:0"
device_type: "CPU"
memory_limit: 268435456
locality {
}
incarnation: 269018436651569152
, name: "/device:GPU:0"
device_type: "GPU"
memory_limit: 11280557671
locality {
  bus_id: 1
  links {
    link {
      device_id: 1
      type: "StreamExecutor"
      strength: 1
    }
  }
}
incarnation: 10458591191837972466
physical_device_desc: "device: 0, name: Tesla K80, pci bus id: 0000:04:00.0, compute capability: 3.7"
, name: "/device:GPU:1"
device_type: "GPU"
memory_limit: 11280557671
locality {
  bus_id: 1
  links {
    link {
      type: "StreamExecutor"
      strength: 1
    }
  }
}
incarnation: 5125031955163087717
physical_device_desc: "device: 1, name: Tesla K80, pci bus id: 0000:05:00.0, compute capability: 3.7"
, name: "/device:GPU:2"
device_type: "GPU"
memory_limit: 11280557671
locality {
  bus_id: 2
  numa_node: 1
  links {
    link {
      device_id: 3
      type: "StreamExecutor"
      strength: 1
    }
  }
}
incarnation: 342599987073728080
physical_device_desc: "device: 2, name: Tesla K80, pci bus id: 0000:84:00.0, compute capability: 3.7"
, name: "/device:GPU:3"
device_type: "GPU"
memory_limit: 11280557671
locality {
  bus_id: 2
  numa_node: 1
  links {
    link {
      device_id: 2
      type: "StreamExecutor"
      strength: 1
    }
  }
}
incarnation: 17062050317966939231
physical_device_desc: "device: 3, name: Tesla K80, pci bus id: 0000:85:00.0, compute capability: 3.7"
]
sys.maxsize 9223372036854775807, platform.architecture ('64bit', 'ELF')
load_data_for_generator
Loading movie for P1_artificial_1
Time for loading movie with scan_image_tiff: 0.203 s
normalizing the movie
movie normalization almost done
movie normalization done
Loading movie for P2_artificial_2
Time for loading movie with scan_image_tiff: 0.21 s
normalizing the movie
movie normalization almost done
movie normalization done
P8_18_10_24_a005 long transient in cell 14 of duration 406 frames at frame 1
P8_18_10_24_a005 long transient in cell 16 of duration 323 frames at frame 1
P8_18_10_24_a005 long transient in cell 59 of duration 265 frames at frame 5
P8_18_10_24_a005 long transient in cell 60 of duration 247 frames at frame 1
P8_18_10_24_a005 long transient in cell 94 of duration 266 frames at frame 2
P8_18_10_24_a005 long transient in cell 238 of duration 427 frames at frame 1
P8_18_10_24_a005 long transient in cell 338 of duration 328 frames at frame 1
P8_18_10_24_a006 long transient in cell 28 of duration 848 frames at frame 1
P11_17_11_24_a000 long transient in cell 5 of duration 265 frames at frame 4017
clean_raster_at_concatenation done
total_n_cells 90
split_order [0 1 2]
ms_str artificial_ms_1
ms_str artificial_ms_2
ms_str p7_171012_a000_ms
ms_str p8_18_10_24_a006_ms
ms_str p11_17_11_24_a000_ms
ms_str p12_171110_a000_ms
ms_str p13_18_10_29_a001_ms
ms_str p8_18_10_24_a005_ms
movie_count 48056
####################
VALIDATION DATA
####################
##########
##########
##########
len train data 1174

n_real_and_fake_transient 0


real: transformations, min 0, max 0, mean 0.0
real: n_transient_dict {1: 333, 2: 133, 3: 59, 5: 3, 4: 15, 6: 1}
[34m1 full real transient perc: 61.21 %[30m
[34m2+ full real transient perc: 38.79 %[30m
real: n_cropped_transient_dict {1: 46, 2: 7}
[34mFull real: 91.12 %[30m
[34mCropped real: 8.88 %[30m
real: transient_lengths n 857 / min-max 2 - 75
real: mean transient_amplitudes 0.4752182776776855


fake: transformations, min 0, max 0, mean 0.0
fake: n_transient_dict {1: 150, 2: 76, 3: 53, 4: 24, 7: 1, 5: 6, 6: 3, 8: 1}
[34m1 full fake transient perc: 47.77 %[30m
[34m2+ full fake transient perc: 52.23 %[30m
fake: n_cropped_transient_dict {1: 42, 2: 3}
[34mFull fake: 87.47 %[30m
[34mCropped fake: 12.53 %[30m
fake: transient_lengths n 620 / min-max 2 - 32
fake: mean transient_amplitudes 1.031728401507204


[34mTotal movie with real transients 597: 50.85 %[30m
[34mTotal movie with fake transients 359: 30.58 %[30m
[34mn_only_neuropil 218: 18.57 %[30m


n_movies_by_session {'P7_17_10_12_a000': 216, 'P8_18_10_24_a006': 248, 'P11_17_11_24_a000': 193, 'P12_17_11_10_a000': 232, 'P13_18_10_29_a001': 285}
[34mP7_17_10_12_a000: 18.4 %[30m
[34mP8_18_10_24_a006: 21.12 %[30m
[34mP11_17_11_24_a000: 16.44 %[30m
[34mP12_17_11_10_a000: 19.76 %[30m
[34mP13_18_10_29_a001: 24.28 %[30m
n_movies_by_age {7: 216, 8: 248, 11: 193, 12: 232, 13: 285}
[34mp7: 18.4 %[30m
[34mp8: 21.12 %[30m
[34mp11: 16.44 %[30m
[34mp12: 19.76 %[30m
[34mp13: 24.28 %[30m
####################
TRAINING DATA
####################
##########
##########
##########
len train data 57430

n_real_and_fake_transient 0


real: transformations, min 0, max 3, mean 0.28
real: n_transient_dict {1: 17323, 2: 7786, 3: 2651, 4: 833, 5: 177, 6: 27}
[34m1 full real transient perc: 60.16 %[30m
[34m2+ full real transient perc: 39.84 %[30m
real: n_cropped_transient_dict {1: 2782, 2: 150}
[34mFull real: 90.76 %[30m
[34mCropped real: 9.24 %[30m
real: transient_lengths n 35816 / min-max 1 - 90
real: mean transient_amplitudes 0.7434706236091251


fake: transformations, min 0, max 3, mean 0.2
fake: n_transient_dict {6: 1501, 7: 1352, 9: 780, 8: 1224, 10: 236, 5: 1844, 4: 2355, 3: 2855, 2: 2919, 1: 3725, 11: 25, 12: 6}
[34m1 full fake transient perc: 19.79 %[30m
[34m2+ full fake transient perc: 80.21 %[30m
fake: n_cropped_transient_dict {1: 756, 2: 47}
[34mFull fake: 95.91 %[30m
[34mCropped fake: 4.09 %[30m
fake: transient_lengths n 63936 / min-max 2 - 46
fake: mean transient_amplitudes 1.0818903890437699


[34mTotal movie with real transients 31729: 55.25 %[30m
[34mTotal movie with fake transients 19625: 34.17 %[30m
[34mn_only_neuropil 6076: 10.58 %[30m


n_movies_by_session {'P1_artificial_1': 3856, 'P2_artificial_2': 3856, 'P7_17_10_12_a000': 13422, 'P8_18_10_24_a006': 7435, 'P11_17_11_24_a000': 7970, 'P12_17_11_10_a000': 6873, 'P13_18_10_29_a001': 8594, 'P8_18_10_24_a005': 5424}
[34mP1_artificial_1: 6.71 %[30m
[34mP2_artificial_2: 6.71 %[30m
[34mP7_17_10_12_a000: 23.37 %[30m
[34mP8_18_10_24_a006: 12.95 %[30m
[34mP11_17_11_24_a000: 13.88 %[30m
[34mP12_17_11_10_a000: 11.97 %[30m
[34mP13_18_10_29_a001: 14.96 %[30m
[34mP8_18_10_24_a005: 9.44 %[30m
n_movies_by_age {1: 3856, 2: 3856, 7: 13422, 8: 12859, 11: 7970, 12: 6873, 13: 8594}
[34mp1: 6.71 %[30m
[34mp2: 6.71 %[30m
[34mp7: 23.37 %[30m
[34mp8: 22.39 %[30m
[34mp11: 13.88 %[30m
[34mp12: 11.97 %[30m
[34mp13: 14.96 %[30m
####################
TRAINING DATA_balanced
####################
##########
##########
##########
len train data 192246

n_real_and_fake_transient 0


real: transformations, min 2, max 6, mean 3.88
real: n_transient_dict {1: 68742, 2: 27709, 3: 9681, 4: 3343, 5: 658, 6: 120}
[34m1 full real transient perc: 62.35 %[30m
[34m2+ full real transient perc: 37.65 %[30m
real: n_cropped_transient_dict {1: 10099, 2: 504}
[34mFull real: 91.23 %[30m
[34mCropped real: 8.77 %[30m
real: transient_lengths n 35816 / min-max 1 - 90
real: mean transient_amplitudes 0.7434706236091251


fake: transformations, min 2, max 6, mean 2.3
fake: n_transient_dict {6: 3984, 7: 3861, 9: 2304, 8: 3618, 10: 708, 5: 4755, 4: 6061, 3: 7299, 2: 7893, 1: 10748, 11: 75, 12: 18}
[34m1 full fake transient perc: 20.94 %[30m
[34m2+ full fake transient perc: 79.06 %[30m
fake: n_cropped_transient_dict {1: 2379, 2: 139}
[34mFull fake: 95.32 %[30m
[34mCropped fake: 4.68 %[30m
fake: transient_lengths n 63932 / min-max 2 - 46
fake: mean transient_amplitudes 1.0819341044998667


[34mTotal movie with real transients 120856: 62.87 %[30m
[34mTotal movie with fake transients 53842: 28.01 %[30m
[34mn_only_neuropil 17548: 9.13 %[30m


n_movies_by_session {'P1_artificial_1': 18357, 'P2_artificial_2': 17758, 'P7_17_10_12_a000': 38187, 'P8_18_10_24_a006': 21993, 'P11_17_11_24_a000': 30155, 'P12_17_11_10_a000': 30454, 'P13_18_10_29_a001': 27127, 'P8_18_10_24_a005': 8215}
[34mP1_artificial_1: 9.55 %[30m
[34mP2_artificial_2: 9.24 %[30m
[34mP7_17_10_12_a000: 19.86 %[30m
[34mP8_18_10_24_a006: 11.44 %[30m
[34mP11_17_11_24_a000: 15.69 %[30m
[34mP12_17_11_10_a000: 15.84 %[30m
[34mP13_18_10_29_a001: 14.11 %[30m
[34mP8_18_10_24_a005: 4.27 %[30m
n_movies_by_age {1: 18357, 2: 17758, 7: 38187, 8: 30208, 11: 30155, 12: 30454, 13: 27127}
[34mp1: 9.55 %[30m
[34mp2: 9.24 %[30m
[34mp7: 19.86 %[30m
[34mp8: 15.71 %[30m
[34mp11: 15.69 %[30m
[34mp12: 15.84 %[30m
[34mp13: 14.11 %[30m
Time for loading data for generator: 49.601 s
n_samples before data augmentation: 44755
n_samples after data augmentation: 192246
Time to create generator: 17.389 s
input_shape (100, 25, 25, 1)
training_data n_samples 192246
valid_data n_samples 1174
Data loaded
Building the model on 4 GPU
merged.shape (?, ?, 256)
Creating Model instance
After Creating Model instance
__________________________________________________________________________________________________
Layer (type)                    Output Shape         Param #     Connected to                     
==================================================================================================
input_0 (InputLayer)            (None, 100, 25, 25,  0                                            
__________________________________________________________________________________________________
input_1 (InputLayer)            (None, 100, 25, 25,  0                                            
__________________________________________________________________________________________________
input_2 (InputLayer)            (None, 100, 25, 25,  0                                            
__________________________________________________________________________________________________
time_distributed_1 (TimeDistrib (None, 100, 2048)    259008      input_0[0][0]                    
__________________________________________________________________________________________________
time_distributed_2 (TimeDistrib (None, 100, 2048)    259008      input_1[0][0]                    
__________________________________________________________________________________________________
time_distributed_3 (TimeDistrib (None, 100, 2048)    259008      input_2[0][0]                    
__________________________________________________________________________________________________
permute_1 (Permute)             (None, 2048, 100)    0           time_distributed_1[0][0]         
__________________________________________________________________________________________________
permute_3 (Permute)             (None, 2048, 100)    0           time_distributed_2[0][0]         
__________________________________________________________________________________________________
permute_5 (Permute)             (None, 2048, 100)    0           time_distributed_3[0][0]         
__________________________________________________________________________________________________
dense_1 (Dense)                 (None, 2048, 100)    10100       permute_1[0][0]                  
__________________________________________________________________________________________________
dense_2 (Dense)                 (None, 2048, 100)    10100       permute_3[0][0]                  
__________________________________________________________________________________________________
dense_3 (Dense)                 (None, 2048, 100)    10100       permute_5[0][0]                  
__________________________________________________________________________________________________
permute_2 (Permute)             (None, 100, 2048)    0           dense_1[0][0]                    
__________________________________________________________________________________________________
permute_4 (Permute)             (None, 100, 2048)    0           dense_2[0][0]                    
__________________________________________________________________________________________________
permute_6 (Permute)             (None, 100, 2048)    0           dense_3[0][0]                    
__________________________________________________________________________________________________
multiply_1 (Multiply)           (None, 100, 2048)    0           time_distributed_1[0][0]         
                                                                 permute_2[0][0]                  
__________________________________________________________________________________________________
multiply_2 (Multiply)           (None, 100, 2048)    0           time_distributed_2[0][0]         
                                                                 permute_4[0][0]                  
__________________________________________________________________________________________________
multiply_3 (Multiply)           (None, 100, 2048)    0           time_distributed_3[0][0]         
                                                                 permute_6[0][0]                  
__________________________________________________________________________________________________
bidirectional_1 (Bidirectional) (None, 100, 256)     2229248     multiply_1[0][0]                 
__________________________________________________________________________________________________
bidirectional_3 (Bidirectional) (None, 100, 256)     2229248     multiply_2[0][0]                 
__________________________________________________________________________________________________
bidirectional_5 (Bidirectional) (None, 100, 256)     2229248     multiply_3[0][0]                 
__________________________________________________________________________________________________
concatenate_1 (Concatenate)     (None, 100, 2304)    0           bidirectional_1[0][0]            
                                                                 multiply_1[0][0]                 
__________________________________________________________________________________________________
concatenate_3 (Concatenate)     (None, 100, 2304)    0           bidirectional_3[0][0]            
                                                                 multiply_2[0][0]                 
__________________________________________________________________________________________________
concatenate_5 (Concatenate)     (None, 100, 2304)    0           bidirectional_5[0][0]            
                                                                 multiply_3[0][0]                 
__________________________________________________________________________________________________
bidirectional_2 (Bidirectional) (None, 100, 512)     5244928     concatenate_1[0][0]              
__________________________________________________________________________________________________
bidirectional_4 (Bidirectional) (None, 100, 512)     5244928     concatenate_3[0][0]              
__________________________________________________________________________________________________
bidirectional_6 (Bidirectional) (None, 100, 512)     5244928     concatenate_5[0][0]              
__________________________________________________________________________________________________
concatenate_2 (Concatenate)     (None, 100, 2560)    0           bidirectional_2[0][0]            
                                                                 multiply_1[0][0]                 
__________________________________________________________________________________________________
concatenate_4 (Concatenate)     (None, 100, 2560)    0           bidirectional_4[0][0]            
                                                                 multiply_2[0][0]                 
__________________________________________________________________________________________________
concatenate_6 (Concatenate)     (None, 100, 2560)    0           bidirectional_6[0][0]            
                                                                 multiply_3[0][0]                 
__________________________________________________________________________________________________
concatenate_7 (Concatenate)     (None, 100, 7680)    0           concatenate_2[0][0]              
                                                                 concatenate_4[0][0]              
                                                                 concatenate_6[0][0]              
__________________________________________________________________________________________________
lstm_7 (LSTM)                   (None, 100, 256)     8127488     concatenate_7[0][0]              
__________________________________________________________________________________________________
flatten_2 (Flatten)             (None, 25600)        0           lstm_7[0][0]                     
__________________________________________________________________________________________________
dropout_2 (Dropout)             (None, 25600)        0           flatten_2[0][0]                  
__________________________________________________________________________________________________
dense_4 (Dense)                 (None, 100)          2560100     dropout_2[0][0]                  
==================================================================================================
Total params: 33,399,424
Trainable params: 33,399,424
Non-trainable params: 0
__________________________________________________________________________________________________
None
Time for building and compiling the model: 21.806 s
Epoch 1/30
